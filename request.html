<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="./style.css">
    <script>
        (function (f, b) {
            if (!b.__SV) {
                var e, g, i, h;
                window.mixpanel = b;
                b._i = [];
                b.init = function (e, f, c) {
                    function g(a, d) {
                        var b = d.split(".");
                        2 == b.length && (a = a[b[0]], d = b[1]);
                        a[d] = function () {
                            a.push([d].concat(Array.prototype.slice.call(arguments, 0)))
                        }
                    }
                    var a = b;
                    "undefined" !== typeof c ? a = b[c] = [] : c = "mixpanel";
                    a.people = a.people || [];
                    a.toString = function (a) {
                        var d = "mixpanel";
                        "mixpanel" !== c && (d += "." + c);
                        a || (d += " (stub)");
                        return d
                    };
                    a.people.toString = function () {
                        return a.toString(1) + ".people (stub)"
                    };
                    i = "disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove"
                        .split(" ");
                    for (h = 0; h < i.length; h++) g(a, i[h]);
                    var j = "set set_once union unset remove delete".split(" ");
                    a.get_group = function () {
                        function b(c) {
                            d[c] = function () {
                                call2_args = arguments;
                                call2 = [c].concat(Array.prototype.slice.call(call2_args, 0));
                                a.push([e, call2])
                            }
                        }
                        for (var d = {}, e = ["get_group"].concat(Array.prototype.slice.call(arguments, 0)),
                                c = 0; c < j.length; c++) b(j[c]);
                        return d
                    };
                    b._i.push([e, f, c])
                };
                b.__SV = 1.2;
                e = f.createElement("script");
                e.type = "text/javascript";
                e.async = !0;
                e.src = "undefined" !== typeof MIXPANEL_CUSTOM_LIB_URL ?
                    MIXPANEL_CUSTOM_LIB_URL : "file:" === f.location.protocol &&
                    "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//) ?
                    "https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js" :
                    "//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";
                g = f.getElementsByTagName("script")[0];
                g.parentNode.insertBefore(e, g)
            }
        })(document, window.mixpanel || []);

        // Enabling the debug mode flag is useful during implementation,
        // but it's recommended you remove it for production
        mixpanel.init('84dc173007d763e240e7ed361b3909c7', {
            debug: true
        });

        function trackEventRequestDemo(infor) {
            // get the value of plan to set super property
            // Thật ra chỉ cần đăng ký 1 lần thôi, nhưng để đảm bảo tính chính xác (tức là event nào cũng có), mình sẽ đăng ký ở mỗi file html nào có event
            let accounts = [];
            const getAccounts = localStorage.getItem("accounts");
            if (getAccounts) accounts = JSON.parse(getAccounts);
            mixpanel.register({
                "Plan Type": accounts[0].plan
            });
            let username = localStorage.getItem("name");
            mixpanel.identify(username);
            mixpanel.track('Demo Requested');
            mixpanel.people.set({
                'First Name': infor.firstName,
                'Last Name': infor.lastName,
                'Request Demo Date': infor.date,
                'Business Email': infor.businessEmail,
                'Company Size': infor.companySize,
                'Company Name': infor.companyName
            })
        }
    </script>
</head>

<body>
    <div class="container">
        <h3 style="color:brown; margin-bottom: 1.25rem;">Request A Demo</h3>
        <div class="form-group" style="margin-bottom: 10px">
            <label for="FirstName">First Name</label>
            <input type="text" class="form-control" id="FirstName" placeholder="First Name">
        </div>

        <div class="form-group" style="margin-bottom: 10px">
            <label for="LastName">Last Name</label>
            <input type="text" class="form-control" id="LastName" placeholder="Last Name">
        </div>

        <div class="form-group" style="margin-bottom: 10px">
            <label for="BusinessEmail">Business Email</label>
            <input type="email" class="form-control" id="BusinessEmail" placeholder="Email">
        </div>

        <div id="date-picker-example" class="md-form md-outline input-with-post-icon datepicker"
            style="margin-bottom: 10px" inline="true">
            <label for="RequestDemoDate">Request Demo Date</label>
            <input id="RequestDemoDate" class="form-control" type="date" />
        </div>

        <div class="form-group">
            <label for="CompanySize" style="margin-bottom: 10px">Company Size</label>
            <input type="text" class="form-control" id="CompanySize" placeholder="Company Size">
        </div>

        <div class="form-group">
            <label for="CompanyName" style="margin-bottom: 10px">Company Name</label>
            <input type="text" class="form-control" id="CompanyName" placeholder="Company Name">
        </div>

        <button class="btn btn-primary" style="margin-top: 10px" id="submit">Submit</button>
    </div>
    <script>
        const firstName = document.getElementById("FirstName")
        const lastName = document.getElementById("LastName")
        const email = document.getElementById("BusinessEmail")
        const date = document.getElementById("RequestDemoDate")
        const size = document.getElementById("CompanySize")
        const company = document.getElementById("CompanyName")
        const submit = document.getElementById("submit")

        const validateEmail = (email) => {
            return String(email)
                .toLowerCase()
                .match(
                    /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                );
        };

        function isPositiveInteger(str) {
            if (typeof str !== 'string') {
                return false;
            }

            const num = Number(str);

            if (Number.isInteger(num) && num > 0) {
                return true;
            }

            return false;
        }


        submit.addEventListener("click", () => {
            if (firstName.value === "" || lastName.value === "" || email.value === "" || date.value === "" ||
                size.value === "" || company.value === "") {
                alert("Please fill all the fields")
            } else {
                if (firstName.value.length < 3) {
                    alert("Please enter the first name at least 3 characters")
                    return
                }
                if (lastName.value.length < 6) {
                    alert("Please enter the last name at least 6 characters")
                    return
                }
                if (!validateEmail(email.value)) {
                    alert("Please enter a valid email")
                    return
                }
                if (!date.value) {
                    alert("Please pick a valid date")
                    return
                }
                if (!isPositiveInteger(size.value)) {
                    alert("Please input the valid number and the number is not equal to 0")
                    return
                }
                const requestDemo = {
                    firstName: firstName.value,
                    lastName: lastName.value,
                    date: date.value,
                    businessEmail: email.value,
                    companySize: size.value,
                    companyName: company.value
                }
                localStorage.setItem("request_demo", JSON.stringify(requestDemo))
                trackEventRequestDemo(requestDemo);
                window.location.href = "index.html";
            }
        })
    </script>
</body>

</html>